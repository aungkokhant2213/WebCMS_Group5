<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Open Meteo Weather Visualizations</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #f5f7fa, #c3cfe2);
      color: #333;
      padding: 30px;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 20px;
      color: #2c3e50;
    }

    nav {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
    }

    nav button {
      padding: 12px 20px;
      border: none;
      border-radius: 30px;
      background: #2980b9;
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    nav button:hover {
      background: #1abc9c;
      transform: scale(1.05);
    }

    #chart {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      max-width: 900px;
      margin: 0 auto;
    }

    .tooltip {
      position: absolute;
      padding: 8px 12px;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      font-size: 0.85rem;
      border-radius: 5px;
      pointer-events: none;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }

    svg {
      width: 100%;
      height: auto;
    }

    text {
      font-size: 12px;
      fill: #2c3e50;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Weather Visualizations (Open-Meteo API)</h1>
  <nav>
    <button onclick="renderPieChart()">Pie Chart</button>
    <button onclick="renderLineChart()">Line Chart</button>
    <button onclick="renderBarChart()">Bar Chart</button>
    <button onclick="renderHeatMap()">Heat Map</button>
    <button onclick="renderRadialChart()">Radial Chart</button>
  </nav>
  <div id="chart"></div>

  <script>
    const API_URL = "https://archive-api.open-meteo.com/v1/archive?latitude=43.65&longitude=-79.38&start_date=2024-07-01&end_date=2024-07-07&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&timezone=auto";
    let weatherData;

    async function fetchData() {
      const res = await fetch(API_URL);
      const json = await res.json();
      weatherData = json.daily;
      renderPieChart();
    }

    function clearChart() {
      d3.select("#chart").html("");
    }

    function renderPieChart() {
      clearChart();
      const data = weatherData.precipitation_sum.map((p, i) => {
        if (p === 0) return { type: "Sunny", value: 1 };
        else if (p < 2) return { type: "Light Rain", value: 1 };
        else return { type: "Rainy", value: 1 };
      });

      const counts = d3.rollups(data, v => v.length, d => d.type);
      const pie = d3.pie().value(d => d[1]);
      const arc = d3.arc().innerRadius(0).outerRadius(150);
      const color = d3.scaleOrdinal().range(d3.schemeCategory10);

      const svg = d3.select("#chart").append("svg")
        .attr("width", 400).attr("height", 400)
        .append("g").attr("transform", "translate(200,200)");

      svg.selectAll("path")
        .data(pie(counts))
        .enter().append("path")
        .attr("d", arc)
        .attr("fill", d => color(d.data[0]));

      svg.selectAll("text")
        .data(pie(counts))
        .enter().append("text")
        .text(d => d.data[0])
        .attr("transform", d => `translate(${arc.centroid(d)})`)
        .attr("text-anchor", "middle");
    }

    function renderLineChart() {
      clearChart();
      const svg = d3.select("#chart").append("svg")
        .attr("viewBox", "0 0 700 500");

      const x = d3.scalePoint()
        .domain(weatherData.time)
        .range([50, 650]);

      const y = d3.scaleLinear()
        .domain([d3.min(weatherData.temperature_2m_min), d3.max(weatherData.temperature_2m_max)])
        .range([400, 50]);

      const lineMax = d3.line()
        .x((d, i) => x(weatherData.time[i]))
        .y((d) => y(d));

      const lineMin = d3.line()
        .x((d, i) => x(weatherData.time[i]))
        .y((d) => y(d));

      svg.append("path")
        .datum(weatherData.temperature_2m_max)
        .attr("d", lineMax)
        .attr("stroke", "red")
        .attr("fill", "none")
        .attr("stroke-width", 2);

      svg.append("path")
        .datum(weatherData.temperature_2m_min)
        .attr("d", lineMin)
        .attr("stroke", "blue")
        .attr("fill", "none")
        .attr("stroke-width", 2);

      svg.append("g")
        .attr("transform", "translate(0,400)")
        .call(d3.axisBottom(x));

      svg.append("g")
        .attr("transform", "translate(50,0)")
        .call(d3.axisLeft(y));
    }

    function renderBarChart() {
      clearChart();
      const svg = d3.select("#chart").append("svg")
        .attr("viewBox", "0 0 700 500");

      const x = d3.scaleBand()
        .domain(weatherData.time)
        .range([50, 650])
        .padding(0.2);

      const y = d3.scaleLinear()
        .domain([0, d3.max(weatherData.precipitation_sum)])
        .range([400, 50]);

      svg.selectAll("rect")
        .data(weatherData.precipitation_sum)
        .enter()
        .append("rect")
        .attr("x", (d, i) => x(weatherData.time[i]))
        .attr("y", d => y(d))
        .attr("width", x.bandwidth())
        .attr("height", d => 400 - y(d))
        .attr("fill", "steelblue");

      svg.append("g")
        .attr("transform", "translate(0,400)")
        .call(d3.axisBottom(x));

      svg.append("g")
        .attr("transform", "translate(50,0)")
        .call(d3.axisLeft(y));
    }

    function renderHeatMap() {
      clearChart();
      const svg = d3.select("#chart").append("svg")
        .attr("viewBox", "0 0 700 200");

      const x = d3.scaleBand()
        .domain(weatherData.time)
        .range([50, 650]);

      const color = d3.scaleSequential()
        .domain([d3.min(weatherData.temperature_2m_max), d3.max(weatherData.temperature_2m_max)])
        .interpolator(d3.interpolateYlOrRd);

      svg.selectAll("rect")
        .data(weatherData.temperature_2m_max)
        .enter()
        .append("rect")
        .attr("x", (d, i) => x(weatherData.time[i]))
        .attr("y", 50)
        .attr("width", x.bandwidth())
        .attr("height", 100)
        .attr("fill", d => color(d));

      svg.append("g")
        .attr("transform", "translate(0,150)")
        .call(d3.axisBottom(x));
    }

    function renderRadialChart() {
      clearChart();
      const data = weatherData.time.map((d, i) => ({
        day: d,
        min: weatherData.temperature_2m_min[i],
        max: weatherData.temperature_2m_max[i]
      }));

      const svg = d3.select("#chart").append("svg")
        .attr("width", 500).attr("height", 500)
        .append("g")
        .attr("transform", "translate(250,250)");

      const angle = d3.scaleBand()
        .domain(data.map(d => d.day))
        .range([0, 2 * Math.PI]);

      const radius = d3.scaleLinear()
        .domain([d3.min(weatherData.temperature_2m_min), d3.max(weatherData.temperature_2m_max)])
        .range([50, 200]);

      svg.selectAll("path")
        .data(data)
        .enter()
        .append("path")
        .attr("d", d => {
          const start = angle(d.day);
          const end = start + angle.bandwidth();
          const r0 = radius(d.min);
          const r1 = radius(d.max);
          return d3.arc()({ startAngle: start, endAngle: end, innerRadius: r0, outerRadius: r1 });
        })
        .attr("fill", "tomato")
        .attr("stroke", "#fff");
    }

    fetchData();
  </script>
</body>
</html>
